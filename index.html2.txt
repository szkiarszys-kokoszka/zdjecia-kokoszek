<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zdjęcia kokoszek i nie tylko</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:20px; }
    h1 { text-align:center; }
    .panel, .card { background:#fff; padding:15px; border-radius:8px; margin-bottom:20px; }
    .gallery { display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap:15px; }
    img { width:100%; border-radius:6px; }
    .stars span { cursor:pointer; font-size:20px; color:gold; }
    textarea, input { width:100%; margin-bottom:6px; }
    button { margin-bottom:6px; }
    .warn { color:red; font-weight:bold; }
    .avatar { width:40px; height:40px; border-radius:50%; margin-right:8px; vertical-align:middle; }
    .comment { display:flex; align-items:center; margin-bottom:4px; }
    .rank { font-weight:bold; }
  </style>
</head>
<body>

<h1>Zdjęcia kokoszek i nie tylko</h1>

<div class="panel" id="authPanel"></div>
<div class="panel" id="profilePanel" style="display:none"></div>
<div class="panel" id="uploadPanel" style="display:none">
  <h3>Dodaj zdjęcie (admin)</h3>
  <input id="title" placeholder="Nazwa zdjęcia">
  <textarea id="desc" placeholder="Opis zdjęcia"></textarea>
  <input type="file" id="file">
  <button onclick="addImage()">Dodaj</button>
</div>
<div class="gallery" id="gallery"></div>

<script>
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_STORAGE_BUCKET",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();
const auth = firebase.auth();

let isAdmin = false;

// ===== AUTH UI =====
function renderAuth(user){
  const p = document.getElementById('authPanel');
  const prof = document.getElementById('profilePanel');

  if(user && !user.emailVerified){
    p.innerHTML = `<div class="warn">⚠ Konto niezweryfikowane</div>Sprawdź Gmail.<br><button onclick="sendVerify()">Wyślij mail ponownie</button><button onclick="logout()">Wyloguj</button>`;
    prof.style.display='none'; uploadPanel.style.display='none'; return;
  }

  if(user){
    const name = user.displayName || 'Anonim';
    p.innerHTML = `Zalogowany jako: <b>${name}</b> (${user.email})<br><button onclick="logout()">Wyloguj</button>`;

    prof.innerHTML = `<h3>Twój profil</h3><input id="nick" placeholder="Twoja nazwa (nick)" value="${user.displayName || ''}"><input type="file" id="avatarFile"><button onclick="saveProfile()">Zapisz profil</button>`;
    prof.style.display='block';

    if(user.email === 'szkiarszys@gmail.com'){ isAdmin = true; uploadPanel.style.display='block'; }
    else { isAdmin = false; uploadPanel.style.display='none'; }
  } else {
    p.innerHTML = `<h3>Logowanie / Rejestracja</h3><input id="email" placeholder="Email (Gmail)"><input id="pass" type="password" placeholder="Hasło"><button onclick="login()">Zaloguj</button><button onclick="register()">Utwórz konto</button>`;
    prof.style.display='none'; uploadPanel.style.display='none';
  }
}

function login(){ auth.signInWithEmailAndPassword(email.value, pass.value).catch(e=>alert(e.message)); }
function register(){
  auth.createUserWithEmailAndPassword(email.value, pass.value)
    .then(cred=>{ cred.user.sendEmailVerification(); alert('Mail weryfikacyjny wysłany'); auth.signOut(); })
    .catch(e=>alert(e.message));
}
function sendVerify(){ auth.currentUser.sendEmailVerification(); alert('Mail wysłany ponownie'); }
function logout(){ auth.signOut(); }

function saveProfile(){
  const user = auth.currentUser;
  const n = document.getElementById('nick').value.trim();
  const file = document.getElementById('avatarFile').files[0];
  if(n) user.updateProfile({ displayName: n });
  if(file){
    const ref = storage.ref('avatars/' + user.uid);
    ref.put(file).then(()=> ref.getDownloadURL().then(url=> user.updateProfile({ photoURL: url }))); }
  alert('Profil zapisany');
}

auth.onAuthStateChanged(user=>{ renderAuth(user); render(); });

// ===== FUNKCJE =====
async function addImage(){ if(!isAdmin) return alert('Tylko admin'); const t=title.value,d=desc.value,f=file.files[0]; if(!t||!f) return alert('Uzupełnij dane'); const ref=storage.ref('images/'+Date.now()); await ref.put(f); const url=await ref.getDownloadURL(); await db.collection('images').add({title:t,desc:d,url,ratings:[],comments:[]}); }
function avg(a){ return a.length ? (a.reduce((x,y)=>x+y)/a.length).toFixed(1) : 0; }
function rate(id,v){ db.collection('images').doc(id).update({ratings: firebase.firestore.FieldValue.arrayUnion(v)}); }
function comment(id){ const v=document.getElementById('c'+id).value; if(!v) return; const user=auth.currentUser; const name=user?.displayName || 'Anonim'; db.collection('images').doc(id).update({comments: firebase.firestore.FieldValue.arrayUnion({name, text:v})}); }
function del(id){ if(!isAdmin) return; db.collection('images').doc(id).delete(); }
function edit(id,f,v){ if(!isAdmin) return; db.collection('images').doc(id).update({[f]:v}); }
function delComment(id,i){ if(!isAdmin) return; const r=db.collection('images').doc(id); r.get().then(d=>{const c=d.data().comments; c.splice(i,1); r.update({comments:c});}); }

function render(){
  db.collection('images').onSnapshot(s=>{
    gallery.innerHTML='';
    let sorted = s.docs.map(d=>({id:d.id,data:d.data(),avg:avg(d.data().ratings)})).sort((a,b)=>b.avg-a.avg);
    sorted.forEach(doc=>{
      const d=doc.data; const div=document.createElement('div'); div.className='card';
      div.innerHTML=`<img src="${d.url}"><b>${isAdmin?`<input value="${d.title}" onchange="edit('${doc.id}','title',this.value)">`:d.title}</b>
<p>${isAdmin?`<textarea onchange="edit('${doc.id}','desc',this.value)">${d.desc||''}</textarea>`:(d.desc||'')}</p>
Średnia: ${doc.avg} ⭐<br>${[0,1,2,3,4,5].map(v=>`<span onclick="rate('${doc.id}',${v})">★</span>`).join('')}
<br><input id="c${doc.id}" placeholder="Komentarz"><button onclick="comment('${doc.id}')">Dodaj</button>
<ul>${(d.comments||[]).map((c,i)=>`<li class='comment'>${c.name?`<img src='${c.photoURL||'https://i.pravatar.cc/40'}' class='avatar'>` : ''}${c.name || 'Anonim'}: ${c.text} ${isAdmin?`<button onclick=\\"delComment('${doc.id}',${i})\\">x</button>`:''}</li>`).join('')}</ul>
${isAdmin?`<button onclick="del('${doc.id}')">Usuń zdjęcie</button>`:''}`;
      gallery.appendChild(div);
    });
  });
}
</script>

</body>
</html>
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBDCamVhZ_6kZyllMokTS8cf-qoDTj5s3g",
  authDomain: "zdjecia-kokoszek1.firebaseapp.com",
  projectId: "zdjecia-kokoszek1",
  storageBucket: "zdjecia-kokoszek1.firebasestorage.app",
  messagingSenderId: "764900310712",
  appId: "1:764900310712:web:c14fe232ffbcd9a96ebe4d",
  measurementId: "G-P9BR6NKE77"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBDCamVhZ_6kZyllMokTS8cf-qoDTj5s3g",
  authDomain: "zdjecia-kokoszek1.firebaseapp.com",
  projectId: "zdjecia-kokoszek1",
  storageBucket: "zdjecia-kokoszek1.firebasestorage.app",
  messagingSenderId: "764900310712",
  appId: "1:764900310712:web:c14fe232ffbcd9a96ebe4d",
  measurementId: "G-P9BR6NKE77"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

