<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Zdjƒôcia kokoszek</title>
<style>
body { font-family: Arial; background:#f5f5f5; padding:20px }
.box { background:#fff; padding:15px; margin-bottom:15px; border-radius:8px }
.hidden { display:none }
button { margin:5px }
img { max-width:300px; display:block }
</style>
</head>
<body>

<h1>üêî Zdjƒôcia kokoszek</h1>

<div class="box" id="startBox">
  <button onclick="show('register')">Rejestracja</button>
  <button onclick="show('login')">Logowanie</button>
  <button onclick="incognito()">Tryb incognito</button>
</div>

<div class="box hidden" id="registerBox">
  <h3>Rejestracja</h3>
  <input id="regEmail" placeholder="Email"><br>
  <input id="regPass" type="password" placeholder="Has≈Ço"><br>
  <button onclick="register()">Zarejestruj</button>
  <button onclick="show('start')">Cofnij</button>
</div>

<div class="box hidden" id="loginBox">
  <h3>Logowanie</h3>
  <input id="logEmail" placeholder="Email"><br>
  <input id="logPass" type="password" placeholder="Has≈Ço"><br>
  <button onclick="login()">Zaloguj</button>
  <button onclick="show('start')">Cofnij</button>
</div>

<div class="box hidden" id="userBox">
  Zalogowany jako: <span id="userEmail"></span>
  <button onclick="logout()">Wyloguj</button>
</div>

<div class="box hidden" id="uploadBox">
  <h3>Dodaj zdjƒôcie (ADMIN)</h3>
  <input id="photoName" placeholder="Nazwa"><br>
  <textarea id="photoDesc" placeholder="Opis"></textarea><br>
  <input type="file" id="photoFile"><br>
  <button onclick="uploadPhoto()">Dodaj</button>
</div>

<div id="gallery"></div>

<!-- FIREBASE v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDskXdRJfexDefGsNWedNQA2VWN8KUKJ9Q",
  authDomain: "zdjecia-kokoszek2137.firebaseapp.com",
  projectId: "zdjecia-kokoszek2137",
  storageBucket: "zdjecia-kokoszek2137.appspot.com",
  messagingSenderId: "936920168632",
  appId: "1:936920168632:web:0469dce19d9d4a5ab25c4d"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

const ADMIN = "szkiarszys@gmail.com";
let incognitoMode = false;

function show(v){
  startBox.classList.add("hidden");
  registerBox.classList.add("hidden");
  loginBox.classList.add("hidden");
  userBox.classList.add("hidden");
  uploadBox.classList.add("hidden");

  if(v==="start") startBox.classList.remove("hidden");
  if(v==="register") registerBox.classList.remove("hidden");
  if(v==="login") loginBox.classList.remove("hidden");
}

function register(){
  const e = regEmail.value;
  const p = regPass.value;
  auth.createUserWithEmailAndPassword(e,p)
  .then(res=>{
    res.user.sendEmailVerification();
    alert("Sprawd≈∫ Gmail i kliknij link!");
    show("start");
  })
  .catch(err=>alert(err.message));
}

function login(){
  auth.signInWithEmailAndPassword(logEmail.value,logPass.value)
  .catch(err=>alert(err.message));
}

function logout(){
  auth.signOut();
  show("start");
}

function incognito(){
  incognitoMode=true;
  loadGallery();
}

auth.onAuthStateChanged(user=>{
  if(user){
    userBox.classList.remove("hidden");
    userEmail.textContent=user.email;
    if(user.email===ADMIN) uploadBox.classList.remove("hidden");
    loadGallery();
  }
});

function uploadPhoto(){
  const file = photoFile.files[0];
  if(!file) return alert("Wybierz plik");
  const ref = storage.ref("photos/"+Date.now());
  ref.put(file).then(()=>{
    ref.getDownloadURL().then(url=>{
      db.collection("photos").add({
        name: photoName.value,
        desc: photoDesc.value,
        url:url,
        ratings:[],
        comments:[]
      });
      loadGallery();
    });
  });
}

function loadGallery(){
  gallery.innerHTML="";
  db.collection("photos").get().then(snap=>{
    snap.forEach(d=>{
      const p=d.data();
      gallery.innerHTML+=`
      <div class="box">
        <h3>${p.name}</h3>
        <p>${p.desc}</p>
        <img src="${p.url}">
      </div>`;
    });
  });
}
</script>

</body>
</html>









