
<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Zdjƒôcia kokoszek i nie tylko</title>
<style>
body { font-family: Arial; background:#f5f5f5; padding:20px; }
.box { background:white; padding:15px; margin-bottom:15px; border-radius:8px; }
button { margin:5px; }
img { max-width:300px; display:block; margin-bottom:10px; }
.hidden { display:none; }
</style>
</head>
<body>

<h1>üêî Zdjƒôcia kokoszek i nie tylko</h1>

<!-- STARTOWY WIDOK -->
<div class="box" id="startBox">
  <button onclick="showView('register')">Rejestracja</button>
  <button onclick="showView('login')">Logowanie</button>
  <button onclick="incognito()">Tryb incognito</button>
</div>

<!-- REJESTRACJA -->
<div class="box hidden" id="registerBox">
  <h3>Rejestracja</h3>
  <input id="regEmail" placeholder="Email"><br>
  <input id="regPass" type="password" placeholder="Has≈Ço"><br>
  <button onclick="register()">Zarejestruj siƒô</button>
  <button onclick="showView('start')">Cofnij</button>
</div>

<!-- LOGOWANIE -->
<div class="box hidden" id="loginBox">
  <h3>Logowanie</h3>
  <input id="loginEmail" placeholder="Email"><br>
  <input id="loginPass" type="password" placeholder="Has≈Ço"><br>
  <button onclick="login()">Zaloguj siƒô</button>
  <button onclick="showView('start')">Cofnij</button>
</div>

<!-- GALERIA -->
<div class="box hidden" id="userBox">
  Zalogowany jako: <span id="userEmail"></span>
  <button onclick="logout()">Wyloguj</button>
</div>

<div class="box hidden" id="uploadBox">
  <h3>Dodaj zdjƒôcie</h3>
  <input id="photoName" placeholder="Nazwa zdjƒôcia"><br>
  <textarea id="photoDesc" placeholder="Opis"></textarea><br>
  <input type="file" id="photoFile"><br>
  <button onclick="uploadPhoto()">Dodaj</button>
</div>

<div id="gallery"></div>

<script type="module">
// ELEMENTY
const startBox = document.getElementById("startBox");
const registerBox = document.getElementById("registerBox");
const loginBox = document.getElementById("loginBox");
const userBox = document.getElementById("userBox");
const uploadBox = document.getElementById("uploadBox");
const gallery = document.getElementById("gallery");
const userEmailSpan = document.getElementById("userEmail");

let currentUser = null;
let isIncognito = false;
const ADMIN_EMAIL = "szkiarszys@gmail.com";

// WIDOKI
function showView(view) {
  startBox.classList.add("hidden");
  registerBox.classList.add("hidden");
  loginBox.classList.add("hidden");
  userBox.classList.add("hidden");
  uploadBox.classList.add("hidden");

  if(view === 'start') startBox.classList.remove("hidden");
  if(view === 'register') registerBox.classList.remove("hidden");
  if(view === 'login') loginBox.classList.remove("hidden");
  if(view === 'user') {
    userBox.classList.remove("hidden");
    if(currentUser?.email === ADMIN_EMAIL) uploadBox.classList.remove("hidden");
  }
}

// IMPORT FIREBASE MODU≈Å
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

// KONFIG
const firebaseConfig = {
  apiKey: "AIzaSyDskXdRJfexDefGsNWedNQA2VWN8KUKJ9Q",
  authDomain: "zdjecia-kokoszek2137.firebaseapp.com",
  projectId: "zdjecia-kokoszek2137",
  storageBucket: "zdjecia-kokoszek2137.appspot.com",
  messagingSenderId: "936920168632",
  appId: "1:936920168632:web:0469dce19d9d4a5ab25c4d",
  measurementId: "G-WJK0MNHXVL"
};

// INICJALIZACJA
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth();
const db = getFirestore();
const storage = getStorage();

// REJESTRACJA
async function register(){
  const email = document.getElementById("regEmail").value;
  const pass = document.getElementById("regPass").value;
  if(!email || !pass) return alert("Wpisz email i has≈Ço");
  try{
    const res = await createUserWithEmailAndPassword(auth,email,pass);
    await sendEmailVerification(res.user);
    alert("Sprawd≈∫ Gmail i kliknij link weryfikacyjny!");
    showView('start');
  }catch(e){
    alert("B≈ÇƒÖd rejestracji: "+e.message);
  }
}

// LOGOWANIE
async function login(){
  const email = document.getElementById("loginEmail").value;
  const pass = document.getElementById("loginPass").value;
  if(!email || !pass) return alert("Wpisz email i has≈Ço");
  try{
    await signInWithEmailAndPassword(auth,email,pass);
  }catch(e){
    alert("B≈ÇƒÖd logowania: "+e.message);
  }
}

// WYLOGUJ
async function logout(){
  await signOut(auth);
  isIncognito = false;
  showView('start');
}

// INC√ìGNITO
function incognito(){
  isIncognito = true;
  showView('user');
  loadGallery();
}

// OBS≈ÅUGA STANU
onAuthStateChanged(auth,user=>{
  currentUser = user;
  if(user){
    isIncognito = false;
    userEmailSpan.textContent = user.email;
    showView('user');
    loadGallery();
  } else if(!isIncognito){
    showView('start');
  }
});

// DODAJ ZDJƒòCIE
async function uploadPhoto(){
  const file = document.getElementById("photoFile").files[0];
  if(!file) return alert("Wybierz plik!");
  const name = document.getElementById("photoName").value || "Bez nazwy";
  const desc = document.getElementById("photoDesc").value || "";

  const r = ref(storage,"photos/"+Date.now());
  await uploadBytes(r,file);
  const url = await getDownloadURL(r);

  await addDoc(collection(db,"photos"),{ name, desc, url, ratings:[], comments:[] });
  loadGallery();
}

// GALERIA
async function loadGallery(){
  gallery.innerHTML="";
  const snap = await getDocs(collection(db,"photos"));
  snap.forEach(d=>{
    const p = d.data();
    const avg = p.ratings.length ? (p.ratings.reduce((a,b)=>a+b)/p.ratings.length).toFixed(1) : "brak";
    const div = document.createElement("div");
    div.className="box";
    div.innerHTML=`
      <h3>${p.name}</h3>
      <p>${p.desc}</p>
      <img src="${p.url}">
      ‚≠ê ≈örednia: ${avg}<br>
      ${!isIncognito && currentUser ? `
        Oce≈Ñ:
        <select onchange="rate('${d.id}',this.value)">
          <option></option>
          <option>0</option><option>1</option><option>2</option>
          <option>3</option><option>4</option><option>5</option>
        </select><br>
        <input placeholder="Komentarz" onkeydown="if(event.key==='Enter')comment('${d.id}',this.value)">
        <button onclick="loadGallery()">Cofnij</button>
      ` : `<i>Tryb incognito ‚Äì tylko podglƒÖd</i>`}
      ${currentUser?.email===ADMIN_EMAIL ? `<button onclick="del('${d.id}')">Usu≈Ñ</button>` : ""}
    `;
    gallery.appendChild(div);
  });
}

// OCENY
async function rate(id,val){
  if(!val) return;
  const refd = doc(db,"photos",id);
  const snap = await getDocs(collection(db,"photos"));
  snap.forEach(async d=>{
    if(d.id===id){
      const arr=[...d.data().ratings, Number(val)];
      await updateDoc(refd,{ratings:arr});
      loadGallery();
    }
  });
}

// KOMENTARZE
async function comment(id,text){
  if(!text) return;
  const refd = doc(db,"photos",id);
  const snap = await getDocs(collection(db,"photos"));
  snap.forEach(async d=>{
    if(d.id===id){
      const arr=[...(d.data().comments||[]), text];
      await updateDoc(refd,{comments:arr});
      loadGallery();
    }
  });
}

// USUWANIE
async function del(id){
  await deleteDoc(doc(db,"photos",id));
  loadGallery();
}
</script>
</body>
</html>











