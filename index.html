<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>ZdjÄ™cia kokoszek i nie tylko</title>
<style>
body { font-family: Arial; background:#f0f0f0; margin:0; padding:0; }
header { background:#ffdd57; padding:10px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:20px; }
#adminPanel { display:none; cursor:pointer; font-weight:bold; }
#auth, #register, #login, #upload, #userBox { padding:20px; }
.hidden { display:none; }
input, textarea, button { margin:5px 0; padding:5px; width:200px; }
.box { background:white; padding:10px; margin:10px 0; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.2); }
img { max-width:100%; display:block; margin:5px 0; }
.likes { cursor:pointer; margin:0 5px; }
@media(max-width:600px) {
  header h1 { font-size:16px; }
  input, textarea, button { width:100%; }
}
</style>
</head>
<body>

<header>
  <h1>ğŸ” ZdjÄ™cia kokoszek i nie tylko</h1>
  <span id="adminPanel">Admin Panel</span>
</header>

<div id="auth">
  <button onclick="showLogin()">Logowanie</button>
  <button onclick="showRegister()">Rejestracja</button>
  <button onclick="incognito()">Tryb incognito</button>
</div>

<div id="register" class="hidden">
  <h2>Rejestracja</h2>
  <input id="regName" placeholder="Nazwa uÅ¼ytkownika"><br>
  <input id="regPass" type="password" placeholder="HasÅ‚o"><br>
  <button onclick="register()">Zarejestruj</button>
  <button onclick="backToAuth()">Cofnij</button>
</div>

<div id="login" class="hidden">
  <h2>Logowanie</h2>
  <input id="logName" placeholder="Nazwa uÅ¼ytkownika"><br>
  <input id="logPass" type="password" placeholder="HasÅ‚o"><br>
  <button onclick="login()">Zaloguj</button>
  <button onclick="backToAuth()">Cofnij</button>
</div>

<div id="userBox" class="hidden box">
  <strong>Zalogowany jako: <span id="userName"></span></strong>
  <button onclick="logout()">Wyloguj</button>
  <button onclick="showUpload()">+</button>
</div>

<div id="upload" class="hidden box">
  <h3>Dodaj zdjÄ™cie</h3>
  <input id="photoName" placeholder="Nazwa zdjÄ™cia"><br>
  <textarea id="photoDesc" placeholder="Opis"></textarea><br>
  <input type="file" id="photoFile"><br>
  <button onclick="uploadPhoto()">Dodaj</button>
  <button onclick="hideUpload()">Cofnij</button>
</div>

<div id="gallery"></div>

<script type="module">
// HTML elements
const authDiv = document.getElementById('auth');
const registerDiv = document.getElementById('register');
const loginDiv = document.getElementById('login');
const userBox = document.getElementById('userBox');
const uploadDiv = document.getElementById('upload');
const galleryDiv = document.getElementById('gallery');
const userNameSpan = document.getElementById('userName');
const adminPanel = document.getElementById('adminPanel');

// Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "TU_WKLEJ_SWÃ“J_API_KEY",
  authDomain: "TU_WKLEJ_SWÃ“J_AUTH_DOMAIN",
  projectId: "TU_WKLEJ_SWÃ“J_PROJECT_ID",
  storageBucket: "TU_WKLEJ_SWÃ“J_STORAGE_BUCKET",
  messagingSenderId: "TU_WKLEJ_SWÃ“J_SENDER_ID",
  appId: "TU_WKLEJ_SWÃ“J_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

let currentUser = null;
const ADMIN_NAME = "Sxsus";

// Show/hide panels
function showRegister(){authDiv.classList.add('hidden'); registerDiv.classList.remove('hidden');}
function showLogin(){authDiv.classList.add('hidden'); loginDiv.classList.remove('hidden');}
function backToAuth(){registerDiv.classList.add('hidden'); loginDiv.classList.add('hidden'); authDiv.classList.remove('hidden');}
function incognito(){authDiv.classList.add('hidden'); userBox.classList.add('hidden'); uploadDiv.classList.add('hidden'); currentUser={name:"Incognito"}; loadGallery();}
function showUpload(){uploadDiv.classList.remove('hidden');}
function hideUpload(){uploadDiv.classList.add('hidden');}

// Register
async function register(){
  const name=document.getElementById('regName').value.trim();
  const pass=document.getElementById('regPass').value.trim();
  if(!name||!pass){alert("Wpisz nazwÄ™ i hasÅ‚o!"); return;}
  // check if name exists
  const snap = await getDocs(collection(db,'users'));
  let exists=false;
  snap.forEach(d=>{if(d.data().name===name) exists=true;});
  if(exists){alert("Ta nazwa juÅ¼ istnieje!"); return;}
  await addDoc(collection(db,'users'),{name,pass});
  alert("Konto utworzone!");
  backToAuth();
}

// Login
async function login(){
  const name=document.getElementById('logName').value.trim();
  const pass=document.getElementById('logPass').value.trim();
  const snap = await getDocs(collection(db,'users'));
  let found=null;
  snap.forEach(d=>{if(d.data().name===name&&d.data().pass===pass) found={id:d.id,...d.data()};});
  if(!found){alert("NieprawidÅ‚owe dane!"); return;}
  currentUser = found;
  userBox.classList.remove('hidden');
  userNameSpan.textContent = currentUser.name;
  if(currentUser.name===ADMIN_NAME) adminPanel.style.display='inline';
  authDiv.classList.add('hidden'); loginDiv.classList.add('hidden');
  loadGallery();
}

// Logout
function logout(){
  currentUser=null; userBox.classList.add('hidden'); authDiv.classList.remove('hidden'); adminPanel.style.display='none';
  galleryDiv.innerHTML='';
}

// Upload photo
async function uploadPhoto(){
  const file=document.getElementById('photoFile').files[0];
  if(!file){alert("Wybierz plik!"); return;}
  const name=document.getElementById('photoName').value||"Bez nazwy";
  const desc=document.getElementById('photoDesc').value||"";
  const r = ref(storage,'photos/'+Date.now());
  await uploadBytes(r,file);
  const url = await getDownloadURL(r);
  await addDoc(collection(db,'photos'),{name,desc,url,author:currentUser.name,likes:0,dislikes:0,comments:[]});
  hideUpload(); loadGallery();
}

// Load gallery
async function loadGallery(){
  galleryDiv.innerHTML='';
  const snap = await getDocs(query(collection(db,'photos'),orderBy('name')));
  snap.forEach(d=>{
    const p=d.data();
    const div=document.createElement('div');
    div.className='box';
    div.innerHTML=`
      <h3>${p.name}</h3>
      <p>${p.desc}</p>
      <img src="${p.url}">
      ğŸ‘ <span class="likes" onclick="like('${d.id}',1)">${p.likes}</span>
      ğŸ‘ <span class="likes" onclick="like('${d.id}',-1)">${p.dislikes}</span>
      <div>
        <input placeholder="Komentarz" onkeydown="if(event.key==='Enter')comment('${d.id}',this.value)">
      </div>
      <div id="comments-${d.id}"></div>
    `;
    galleryDiv.appendChild(div);
    updateComments(d.id,p.comments||[]);
  });
}

// Likes
async function like(id,val){
  if(!currentUser){alert("Zaloguj siÄ™!"); return;}
  const refd=doc(db,'photos',id);
  const snap=await getDocs(collection(db,'photos'));
  snap.forEach(async d=>{if(d.id===id){
    let data=d.data();
    if(val>0) data.likes++; else data.dislikes++;
    await updateDoc(refd,data); loadGallery();
  }});
}

// Comment
async function comment(id,text){
  if(!currentUser||!text) return;
  const refd=doc(db,'photos',id);
  const snap=await getDocs(collection(db,'photos'));
  snap.forEach(async d=>{if(d.id===id){
    let data=d.data();
    data.comments.push({author:currentUser.name,text});
    await updateDoc(refd,data);
    updateComments(id,data.comments);
  }});
}

// Update comments
function updateComments(id,comments){
  const div=document.getElementById('comments-'+id);
  div.innerHTML='';
  comments.forEach(c=>{div.innerHTML+=`<b>${c.author}:</b> ${c.text}<br>`;});
}
</script>
</body>
</html>












